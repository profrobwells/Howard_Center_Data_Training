---
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

::: {style="text-align: center; color: #337DFF;"}
# How Journalists Ask Questions of Data

### Digital Certificate Program

#### Philip Merrill College of Journalism

(ver May 19, 2025)
:::

<br>

::: {style="text-align: center;"}
<img src="assets/Merrill_logo.png" width="370" height="200"/>
:::

::: {style="font-weight:bold;"}
``` markdown
Rob Wells, Ph.D., Associate Professor
```
:::

6 subtopics per course 30 video each - per subtopic

3 hours of content 3-4 lessons per class


1.dpylr verbs (actions that allow users to
solve data manipulation challenges), and the questions each enables us
to ask 

2.Grouping and summarizing (counts, sums and averages); Joins
(combining rows from datasets) and what it enables 

3.Basic statistics

4.How journalists look and think about idea generation for data; How to generate data story ideas

5.Text analysis 

6.Exploratory data visualization

```{r}
#install.packages("tidyverse")
library(tidyverse)
```

We'll explore Life Expectancy Data by country, 1800 to present with
projections to 2100

Source is [gapminder.org](https://www.gapminder.org/data/)

[Documentation is
here](https://www.gapminder.org/data/documentation/gd004/)

#### Import Life Expectancy Data
```{r}
life_expect <- read.csv("./assets/lex.csv")
```


#### Examine Data
```{r}
head(glimpse(life_expect))

```

File types:

-  <chr> = character, text data
-  <dbl> = numeric data

302 columns - Each year life expectancy data
196 rows - each row is a country (195 counties)

## Dpylr verbs 

1.dpylr verbs (actions that allow users to solve data manipulation challenges), and the questions each enables us
to ask 

These are the power verbs in R to identify, filter, summarise and create new fields

Select
Arrange
Filter
Group_by
Summarize
Mutate

We will deploy these tools in the problems below

Highest life expectancy
Which country has the highest life expectancy in 2025?
```{r}

life_expect |> 
  select(country, X2025) |> 
  filter(X2025 == max(X2025, na.rm = TRUE))
  
```
Japan and Singapore, both at 86 years!

### Using filters

Filters can help us find needles in data haystacks.
Let's use a filter to determine counties with the lowest life expectancy in 2025.

```{r}

life_expect |> 
  select(country, X2025) |> 
  filter(X2025 == min(X2025, na.rm = TRUE))



```

Obviously, we have a data problem, with Hong Kong and Liechtenstein registering at zero. Let's adjust our query for results greater than zero
```{r}

life_expect |> 
  select(country, X2025) |> 
  # First filter out zeros and NA values
  filter(X2025 > 0, !is.na(X2025)) |>
  # Then find the minimum among remaining values
  filter(X2025 == min(X2025, na.rm = TRUE)) 



```

### Using means

Average life expectancy in 2025
The result, 73.1551, is stored in the variable "life2025"
```{r}
life2025 <- mean(life_expect$X2025)
life2025

```

Average life expectancy in 1925
```{r}
#Here we added na.rm = TRUE to allow the calculation to skip blank values
life1925 <- mean(life_expect$X1925, na.rm = TRUE)
life1925

```

**38 years was the average life expectancy in 1925!** Wow.

Percentage change in life expectancy, 1925 v 2025
The numbers are stored in these variables, so just do the math
```{r}
(life2025-life1925)/life1925 *100


```

Average life expectancy has increased by about 92% since 1925.

#### YOUR TURN
Using the examples above, determine the life expectancy percentage change from 1975 to 2020.
```{r}

#this portion is blank for the student. 
# The answer is 14.88097
# life1975 <- mean(life_expect$X1975, na.rm = TRUE)
# 
# life2020 <- mean(life_expect$X2020)
# 
# (life2020-life1975)/life1975 *100
```

## Grouping and Summuing. 

2.Grouping and summarizing (counts, sums and averages); Joins
(combining rows from datasets) and what it enables 

### Counting
We know the average life expectancy for 2025, 1975 and 1925.
Let's count the number of countries above these averages


```{r}

life_expect |> 
  select(country, X2025) |> 
  filter(X2025 > life2025) |> 
  count()

```
#### YOUR TURN
Using the example above, determine the the number of countries above the 1975 average life expectancy
```{r}
#this portion is blank for the student. 
# The answer is 113
# life_expect |> 
#   select(country, X1975) |> 
#   filter(X1975 > life1975) |> 
#   count()

```
#### YOUR TURN
Using the example above, determine the the number of countries above the 1925 average life expectancy
```{r}
#this portion is blank for the student. 
# The answer is 64
# life_expect |> 
#   select(country, X1925) |> 
#   filter(X1925 > life1925) |> 
#   count()
```
# Using Mutate
We are now going to categorize countries as above or below the mean life expectancy by using the mutate command. Mutate creates a new column and there are various stratgies to fill in new results. Here we will assign **above** to all counties in 1925 above the mean life expectancy of 38.11 years. We are using case_when which sets up a logical 'if/else' statement to apply the category
```{r}
life_1925 <- life_expect |> 
  select(country, X1925) |> 
  mutate(category = case_when(
         X1925 > life1925 ~ "above",
          X1925 < life1925 ~ "below")
)
```

Let's count the results
```{r}
life_1925 |> 
  count(category)

```

#### YOUR TURN
Using the example above, categorize countries as being above or below the 1975 average life expectancy
```{r}
#this portion is blank for the student. 
# life_1975 <- life_expect |> 
#   select(country, X1975) |> 
#   mutate(category = case_when(
#          X1975 > life1975 ~ "above",
#           X1975 < life1975 ~ "below")
# )
```

#### YOUR TURN
Using the example above, categorize countries as being above or below the 2025 average life expectancy

```{r}
#this portion is blank for the student. 
# life_2025 <- life_expect |>
#   select(country, X2025) |>
#   mutate(category = case_when(
#          X2025 > life2025 ~ "above",
#           X2025 < life2025 ~ "below")
# )
```

Now we combine the three results
--we rename a column to the same name for all three time periods so they can be combined. This is a good example of using mutate.

```{r}
# Transform life_1925 dataframe
life_1925 <- life_1925 %>%
  rename(value = X1925) %>%
  mutate(year = 1925)

life_1975 <- life_1975 %>%
  rename(value = X1975) %>%
  mutate(year = 1975)

life_2025 <- life_2025 %>%
  rename(value = X2025) %>%
  mutate(year = 2025)
```

### Joins

Joins (combining rows from datasets) and what it enables 

We combine the three using rbind
```{r}

# Combine the dataframes
total <- rbind(life_1925, life_1975, life_2025)

```

Count totals by time period

```{r}
total |> 
  group_by(year, category) |> 
  count(category)

```

## Basic statistics

### Percentages
Let's determine the percent above, below the mean

Step 1: Count the categories by year

by grouping by year, we can count up the above and below average countries. The results are in the colummn n
```{r}
total |> 
   group_by(year) |> 
  count(category) 
```

Step Two: Percentage of Whole

We add two lines of code to calculate the percentage. Note how mutate creates a new column that stores the value. And we format it at the end to make it look pretty.

The percent calculation divides the category total into the full number denominator. Because 1925 has 10 null values, we filter those out. Remember, when dealing with historical data, nations and language can change over time.


```{r}
total |> 
   group_by(year) |> 
  count(category) |> 
  filter(!is.na(category)) |> #drops the counties without data
  mutate(percent = n/sum(n)) |> 
  mutate(percent = round(percent*100, 1))

```

Distribution of the data
How are countries grouped? Were there many below the average?


```{r}
life_1925 |> 
   summary(value)
```

We see the lowest value is 21 years life expectancy, the first quartile is up to 32 years, the median value was 36 years, the mean or average was 38 years, the third quartile was 40 years and the maximum value was 64 years.

### Data Visualization

```{r}

life_1925 |> 
  ggplot(aes(x = value)) +
  geom_histogram()
```

```{r}

life_1925 |> 
  summarize(standard_deviation = sd(value, na.rm = TRUE))


```



(actions that allow users to solve data manipulation challenges), 

#### YOUR TURN
Using the examples above
```{r}



```




We see from our quick glance that Andorra lacks entries for the first few years. Let's focus on Andorra using a filter

```{r}

Andorra <- life_expect |> 
  filter(country == "Andorra") |> 
   # Convert to long format so we can work with years as values
  pivot_longer(
    cols = starts_with("X"), 
    names_to = "year",
    values_to = "life_expectancy"
  ) |>
  # Remove the "X" prefix from year names and convert to numeric
  mutate(year = as.numeric(gsub("X", "", year))) |>
  # Keep only years with non-NA values
  filter(!is.na(life_expectancy)) |>
  # Sort by year (optional)
  arrange(year)


```


## Story ideas
4.How journalists look and think about idea generation for data; How to generate data story ideas

----------------------------------------------------------------------------
#Notes
----------------------------------------------------------------------------




Here's another way to combine the three results
This code creates a new table that puts all the the calculations into one place for easier analysis
```{r}

above_average <- data.frame(
  Year = c("1925", "1975", "2025"),
  Countries_Above_Average = c(
    sum(life_expect$X1925 > life1925, na.rm = TRUE),
    sum(life_expect$X1975 > life1975, na.rm = TRUE),
    sum(life_expect$X2025 > life2025, na.rm = TRUE)
  )
)

above_average
```

### Percentages 
Ok, all of that is fine, but do we have a consistent denominator, the same number of countries over time?
Remember, when dealing with historical data, nations and language can change over time.

Count total number of countries

```{r}
life_expect |> 
  select(country, X2025, X1975, X1925) |> 
  summarize(
    count_2025 = sum(!is.na(X2025)),
    count_1975 = sum(!is.na(X1975)),
    count_1925 = sum(!is.na(X1925))
  )

```

```{r}


above_average <- data.frame(
  Year = c("1925", "1975", "2025"),
  Countries_Above_Average = c(
    sum(life_expect$X1925 > life1925, na.rm = TRUE),
    sum(life_expect$X1975 > life1975, na.rm = TRUE),
    sum(life_expect$X2025 > life2025, na.rm = TRUE)
  ),
  Total_Countries_With_Data = c(
    sum(!is.na(life_expect$X1925)),
    sum(!is.na(life_expect$X1975)),
    sum(!is.na(life_expect$X2025))
  )
) |> 
  mutate(Percent_Above_Average = round(
  (Countries_Above_Average / Total_Countries_With_Data) * 100, 
  1
))

above_average



```
